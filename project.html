<!DOCTYPE html>
<html lang="en" >  
<head>
  <meta charset="utf-8">
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <style>
    @font-face {
      font-family: maple;
      src: url(Maplestory\ Light.ttf);
    }
 head{
   background:black;
 }
  body {
  padding-top:50px;
  
  background-image: url("별빛.jpg");
  background-size: cover;
  background-repeat: no-repeat;
  background-position: center;
  
  font-family: 'maple', sans-serif;
  text-align: center;
}

.container {
  max-width: 960px;
  margin: 30px auto;
  padding: 20px;
}
.abcde{
  background-color: white;
  padding: 30px;
  margin-left:100px ;
  margin-right:100px;
  height: 900px;
  font-size: 50px;
  font-weight: bold;
  text-align: center;
  background-color: #ffffff;
  background-color: rgba( 255, 255, 255, 0.75 );
}
h1 {
  font-size: 30px;
  text-align: center;
  margin: 20px 0 20px;
}
h1 small {
  display: block;
  font-size: 15px;
  padding-top: 8px;
  color: gray;
  text-align: right;
  bottom:-1;
  position: absolute;
}

.avatar-upload {
  position: relative;
  max-width: 205px;
  margin: 50px auto;
}
.avatar-edit {
  position: absolute; 
  right :305px;
  
}
.avatar-edit input {
  display: none;
}
.avatar-edit input + label {
  display: inline-block;
  width: 50px;
  height: 50px;
  margin-bottom: 0;
  background: #769dca;
  border: 1px solid transparent;
  box-shadow: 0px 2px 4px 0px rgba(0, 0, 0, 0.12);
  cursor: pointer;
  font-weight: normal;
  transition: all 0.2s ease-in-out;
  position : relative;
}
.avatar-upload .avatar-edit input + label:hover {
  background: #f1f1f1;
  border-color: #d6d6d6;
}

.avatar-upload .avatar-preview {
  width: 300px;
  height: 300px;
  right :60px;
  position: relative;
  border: 6px solid #F8F8F8;
  box-shadow: 0px 2px 4px 0px rgba(0, 0, 0, 0.1);
}
.avatar-upload .avatar-preview > img {
  width: 100%;
  height: 100%;
  background-size: cover;
  background-repeat: no-repeat;
  background-position: center;
}

.button {
  padding: 15px 25px;
  font-size: 24px;
  text-align: center;
  cursor: pointer;
  outline: none;
  color: #fff;
  background-color: #04AA6D;
  border: none;
  border-radius: 15px;
  box-shadow: 0 9px #999;
  
}

.button:hover {background-color: #3e8e41}

.button:active {
  background-color: #3e8e41;
  box-shadow: 0 5px #666;
  transform: translateY(4px);
}
    </style>
  <script>
    window.console = window.console || function(t) {};
  </script>
    
    <script>
    if (document.location.search.match(/type=embed/gi)) {
      window.parent.postMessage("resize", "*");
    }
  </script>
  </head>
  <body translate="no" >


<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.3.1/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>
<script type="text/javascript">
    // More API functions here:
    // https://github.com/googlecreativelab/teachablemachine-community/tree/master/libraries/image

    // the link to your model provided by Teachable Machine export panel
    const URL = "./unse/";

    let model, webcam, labelContainer, maxPredictions, airesult, Axplain;

    // Load the image model and setup the webcam
    async function init() {
        var nones = document.getElementById('#imagePreview')
        Axplain = document.getElementById('explain');
        
        // if($('#imagePreview').val() == ""){
        //  Axplain.innerText = "사진이 없습니다.";
        //  return;
        // }
        const modelURL = URL + "model.json";
        const metadataURL = URL + "metadata.json";
        
        model = await tmImage.load(modelURL, metadataURL);
        maxPredictions = model.getTotalClasses();
        const flip = true; 
        labelContainer = document.getElementById("label-container");
        for (let i = 0; i < maxPredictions; i++) { // and class labels
            labelContainer.appendChild(document.createElement("div"));
        }
        airesult = document.getElementById('ai-result');
        await predict();

    }

    async function predict() {
       
      let bestPrediction = 0;
        let bestPredictionIdx = 0;

        var image = document.getElementById('imagePreview')
        const prediction = await model.predict(image, false);
        for (let i = 0; i < maxPredictions; i++) {
            // const classPrediction =
            //     prediction[i].className + ": " + prediction[i].probability.toFixed(2)*100+"%";
            // labelContainer.childNodes[i].innerHTML = classPrediction;
            if (prediction[i].probability > bestPrediction) {
                bestPrediction = prediction[i].probability
                bestPredictionIdx = i
            }
        }
        if(prediction[bestPredictionIdx].className == "물병자리")
         airesult.innerText ="물병";
        else if(prediction[bestPredictionIdx].className == "물고기자리")
         airesult.innerText ="물고기";
         else if(prediction[bestPredictionIdx].className == "양자리")
         airesult.innerText ="양";
         else if(prediction[bestPredictionIdx].className == "황소자리")
         airesult.innerText ="황소";
         else if(prediction[bestPredictionIdx].className == "쌍둥이자리")
         airesult.innerText ="쌍둥이";
         else if(prediction[bestPredictionIdx].className == "게자리")
         airesult.innerText ="게";
         else if(prediction[bestPredictionIdx].className == "사자자리")
         airesult.innerText ="사자";
         else if(prediction[bestPredictionIdx].className == "처녀자리")
         airesult.innerText ="처녀";
         else if(prediction[bestPredictionIdx].className == "천칭자리")
         airesult.innerText ="천칭";
         else if(prediction[bestPredictionIdx].className == "전갈자리")
         airesult.innerText ="전갈";
         else if(prediction[bestPredictionIdx].className == "사수자리")
         airesult.innerText ="사수";
         else if(prediction[bestPredictionIdx].className == "염소자리")
         airesult.innerText ="염소";
         
    }

</script>
<div class="abcde">
<div class="webcam-container">
    <h1>운세 
    </h1>
    <div class="avatar-upload">
        <div class="avatar-preview">
              <img src="물음표.jpg" id="imagePreview">
            </div>
        </div>
    </div>
    <div class="avatar-edit">
        <input type='file' id="imageUpload" accept=".png, .jpg, .jpeg" />
        <label for="imageUpload"></label>
    </div>

<h1 id="explain">이미지를 넣어주세요</h1>
<button class= "button" id= "aa" type="button" onclick="init()">운세 보기</button>
<h1></h1>
<div id="label-container"></div>
<div id="ai-result"></div>
</div>
<h1><small>제작자 - 이은수</small></h1>
</script>
    <script src="https://cpwebassets.codepen.io/assets/common/stopExecutionOnTimeout-1b93190375e9ccc259df3a57c1abc0e64599724ae30d7ea4c6877eb615f89387.js"></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js'></script>
<script id="rendered-js" >
  
    function readURL(input) {
    if (input.files && input.files[0]) {
        var reader = new FileReader();
        reader.onload = function(e) {
            $('#imagePreview').attr('src', e.target.result); 
            $('#imagePreview').hide();
            $('#imagePreview').fadeIn(650);
        }
        reader.readAsDataURL(input.files[0]);
    }
    }
$("#imageUpload").change(function() {
    readURL(this);
});
</script>
